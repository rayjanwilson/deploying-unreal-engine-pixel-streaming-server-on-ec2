output:
  handler: scripts/output.handler
  file: stack.json

ami: 
  WindowsServer2019: ${ssm:/aws/service/ami-windows-latest/Windows_Server-2019-English-Full-Base}
  WindowsServer2016: ${ssm:/aws/service/ami-windows-latest/Windows_Server-2016-English-Full-Base}
  WindowsServer2012R2: ${ssm:/aws/service/ami-windows-latest/Windows_Server-2012-R2_RTM-English-64Bit-Base}
  amzn2: ${ssm:/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2}

UserData:
  Fn::Base64: !Sub |
    #!/bin/bash -xe
    yum update -y
    yum -y install httpd awslogs
    systemctl enable awslogsd.service
    systemctl enable httpd
    systemctl start awslogsd
    systemctl start httpd
    usermod -a -G apache ec2-user
    chmod 2775 /var/www && find /var/www -type d -exec sudo chmod 2775 {} \;
    find /var/www -type f -exec sudo chmod 0664 {} \;
    wget http://169.254.169.254/latest/meta-data/local-ipv4 -O /var/www/html/index.html

WindowsUserData:
  Fn::Base64: !Sub |
    <script>
    cfn-init.exe -v -c initialize -r WindowsInstance --region ${self:provider.region} -s ${AWS::StackName}
    </script>

KeyPairName: ${opt:keypairname, 'ec2_useast_1'}

UserPasswd: ${opt:userpasswd, 'Ch4ng3M3!'}

OsVersion: ${opt:osversion, 'WindowsServer2019'}


PixelStreamerBootstrapLocation: ${opt:streamerbootstraploc, 'https://ue4-pixel-streamer-dev-khgkjhsdas7.s3.amazonaws.com/UE4-Pixel-Streamer-Bootstrap.ps1'}
PixelStreamerBuildLocation: ${opt:streamerbuildloc, 'https://ue4-pixel-streamer-dev-khgkjhsdas7.s3.amazonaws.com/WindowsNoEditor.zip'}
PixelStreamingAccessCIDR: ${opt:pixelcidr, '0.0.0.0/0'}
NiceDCVAccessCIDR: ${opt:nicedcvcidr, '0.0.0.0/0'}
DiskSize: 30
InstanceType: g4dn.4xlarge

VersionMap:
  firefox:
    default: Firefox_Setup_57.0.exe